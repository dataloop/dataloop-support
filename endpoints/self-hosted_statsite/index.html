<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="support@dataloop.io">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Self hosted statsite - Dataloop Support</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Self hosted statsite";
    var mkdocs_page_input_path = "endpoints/self-hosted_statsite.md";
    var mkdocs_page_url = "/endpoints/self-hosted_statsite/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Dataloop Support</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Account model</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../account_model/backup_restore/">Backup restore</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../account_model/overview/">Overview</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../account_model/private_packs/">Private packs</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Agent</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../agent/command_line_interface/">Command line interface</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../agent/config_management/">Config management</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../agent/configuration/">Configuration</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../agent/fingerprints/">Fingerprints</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../agent/">Home</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../agent/installation_docker/">Installation docker</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../agent/installation_linux/">Installation linux</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../agent/installation_raspberry_pi/">Installation raspberry pi</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../agent/installation_windows/">Installation windows</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../agent/solo_mode/">Solo mode</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../agent/supported_operating_systems/">Supported operating systems</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../agent/uninstall/">Uninstall</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Alerting</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../alerting/agent_alerts/">Agent alerts</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../alerting/metric_alerts/">Metric alerts</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../alerting/plugin_alerts/">Plugin alerts</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../alerting/rules/">Rules</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../alerting/webhook/">Webhook</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Dashboards</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../dashboards/annotations/">Annotations</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../dashboards/grafana/">Grafana</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../dashboards/graph_widgets/">Graph widgets</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../dashboards/numeric_widgets/">Numeric widgets</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../dashboards/public_dashboards/">Public dashboards</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../dashboards/troubleshooting/">Troubleshooting</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Endpoints</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../collectd/">Collectd</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../graphite/">Graphite</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../hosted_statsd/">Hosted statsd</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../influxdb/">Influxdb</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../self-hosted_statsd/">Self hosted statsd</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Self hosted statsite</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#self-hosted-statsite">Self-Hosted Statsite</a></li>
                
                    <li><a class="toctree-l4" href="#troubleshooting">Troubleshooting</a></li>
                
                    <li><a class="toctree-l4" href="#sending-to-graphite-dataloop">Sending to Graphite + Dataloop</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../statsd/">Statsd</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../statsd_clients/">Statsd clients</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Getting started</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../getting_started/API/">API</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../getting_started/command_line_utility/">Command line utility</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../getting_started/data_retention_policy/">Data retention policy</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../getting_started/faq/">Faq</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../getting_started/getting_help/">Getting help</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../getting_started/">Home</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../getting_started/overview/">Overview</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../getting_started/roadmap/">Roadmap</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../getting_started/security/">Security</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../getting_started/use_cases/">Use cases</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../getting_started/where_we_fit/">Where we fit</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Integrations</span></li>

        
            
    <ul class="subnav">
    <li><span>Thirdparty</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrations/thirdparty/aws/">Aws</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Webhook</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrations/webhook/bigpanda/">Bigpanda</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrations/webhook/hipchat/">Hipchat</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrations/webhook/opsgenie/">Opsgenie</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrations/webhook/pagerduty/">Pagerduty</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrations/webhook/slack/">Slack</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../integrations/webhook/victorops/">Victorops</a>
        
    </li>

        
    </ul>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Nagios</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../nagios/built_in_python/">Built in python</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../nagios/nagios_performance_data/">Nagios performance data</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../nagios/nagios_plugins/">Nagios plugins</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../nagios/plugin_deplotmen_models/">Plugin deplotmen models</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../nagios/powershell/">Powershell</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../nagios/prometheus_plugins/">Prometheus plugins</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Dataloop Support</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Endpoints &raquo;</li>
        
      
    
    <li>Self hosted statsite</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/dataloop/dataloop-support/edit/master/docs/endpoints/self-hosted_statsite.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="self-hosted-statsite">Self-Hosted Statsite</h1>
<p>Statsite is an awesome alternative to the Etsy StatsD server implementation. Install as per the instructions here:</p>
<p>https://github.com/armon/statsite</p>
<p>Then create a statsite.conf with the following configuration:</p>
<pre><code>[statsite]
bind_address = 0.0.0.0
tcp_port = 8125
udp_port = 8125
log_level = INFO
flush_interval = 10
timer_eps = 0.01
set_eps = 0.02
stream_cmd = python sinks/graphite.py graphite.dataloop.io 2003 fingerprint.
input_counter = numStats
extended_counters = true
</code></pre>

<p>The important line here is the stream_cmd setting. You may need to update the location of the graphite.py file. The last part of the line is the metric prefix that is sent to dataloop. Usually people install a Dataloop agent onto their Statsite server so they can use the fingerprint string from <code>/etc/dataloop/agent.finger</code>. Remember to append a fullstop to the end of the fingerprint.</p>
<p>An example of a good stream_cmd line is:</p>
<pre><code>stream_cmd = python sinks/graphite.py graphite.dataloop.io 2003 529b7fc2-2de5-4525-983a-184c8f43c085.
</code></pre>

<h2 id="troubleshooting">Troubleshooting</h2>
<p>The only reliable way I have found to troubleshoot this is to open up netcat to listen on a new port, then temporarily change statsite.conf to send metrics to it.</p>
<p>For example open a new tab and run netcat to listen on port 2004</p>
<pre><code># nc -l 2004
</code></pre>

<p>Now change the stream_cmd to point to port 2004 localhost</p>
<pre><code>stream_cmd = python sinks/graphite.py localhost 2004 529b7fc2-2de5-4525-983a-184c8f43c085.
</code></pre>

<p>Start statsite and wait for 10 seconds. Your netcat listening tab will show you the metrics being sent. An example of some that look correct:</p>
<pre><code>529b7fc2-2de5-4525-983a-184c8f43c085.production.agent.flush.size.sum 57619.000000 1436185723
529b7fc2-2de5-4525-983a-184c8f43c085.production.agent.flush.size.sum_sq 571869.000000 1436185723
529b7fc2-2de5-4525-983a-184c8f43c085.production.agent.flush.size.mean 9.741167 1436185723
529b7fc2-2de5-4525-983a-184c8f43c085.production.agent.flush.size.lower 1.000000 1436185723
529b7fc2-2de5-4525-983a-184c8f43c085.production.agent.flush.size.upper 10.000000 1436185723
529b7fc2-2de5-4525-983a-184c8f43c085.production.agent.flush.size.count 5915 1436185723
529b7fc2-2de5-4525-983a-184c8f43c085.production.agent.flush.size.stdev 1.338330 1436185723
</code></pre>

<p>Here we can see the fingerprint first, then the dot seperator between the metric paths followed by the value and timestamp. If you have a malformed fingerprint.metric.path then metrics won't display in dataloop</p>
<p>Once you have confirmed it's working against localhost port 2004 you can flip it back to sending to dataloop. Metrics will appear under the agent fingerprint that you used.</p>
<p>Also, be careful about the time on your Statsite server. Installing NTP should help with this. Dataloop will display whatever values against the timestamp you send in, so if your timestamps are wrong strangeness abounds.</p>
<h2 id="sending-to-graphite-dataloop">Sending to Graphite + Dataloop</h2>
<p>Sometimes people want to keep their local Graphite server running in parallel. You can do that quite easily with Statsite by changing the sink/graphite.py that they provide to a modified version.</p>
<p>Grab the modified one from here: <a href="https://gist.github.com/sacreman/fb2984d2497103ab3afd">gist</a></p>
<p>You'll need to modify the <code>self.fingerprint</code> variable in the init script with a valid agent fingerprint as discussed above.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../statsd/" class="btn btn-neutral float-right" title="Statsd">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../self-hosted_statsd/" class="btn btn-neutral" title="Self hosted statsd"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Â© Dataloop 2017</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/dataloop/dataloop-support" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../self-hosted_statsd/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../statsd/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
